<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mod Size Fetcher</title>
</head>
<body>
    <h1>Mod Size Fetcher</h1>
    <input type="file" id="fileInput" accept=".html" />
    <div id="output"></div>
    
    <script>
        const steamApiUrl = "https://steamapi.xpaw.me/IPublishedFileService/GetDetails/v1/";

        // Function to parse the uploaded HTML file
        function parseModList(fileContent) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(fileContent, 'text/html');
            const modLinks = doc.querySelectorAll('a[href^="https://steamcommunity.com/sharedfiles/filedetails/?id="]');
            
            const modIds = [];
            modLinks.forEach(link => {
                const match = link.href.match(/id=(\d+)/);
                if (match) {
                    modIds.push(match[1]);
                }
            });

            fetchModSizes(modIds);
        }

        // Function to fetch mod sizes from steamapi.xpaw.me
        async function fetchModSizes(modIds) {
            let totalSize = 0;
            for (const modId of modIds) {
                const modSize = await fetchModSize(modId);
                if (modSize) {
                    totalSize += modSize;
                }
            }

            // Display the total size
            const outputDiv = document.getElementById('output');
            outputDiv.textContent = `Total Mod Size: ${(totalSize / 1048576).toFixed(2)} MB`; // Convert to MB
        }

        // Function to fetch individual mod size from steamapi.xpaw.me
        async function fetchModSize(modId) {
            const apiUrl = `${steamApiUrl}?publishedfileids[]=${modId}`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                const modSize = data.response.publishedfiledetails[0]?.file_size;
                if (modSize) {
                    return modSize; // Return the size in bytes
                } else {
                    console.error(`Could not retrieve size for mod ID ${modId}`);
                    return 0;
                }
            } catch (error) {
                console.error(`Error fetching mod size for mod ID ${modId}:`, error);
                return 0;
            }
        }

        // Handle file upload
        document.getElementById('fileInput').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file && file.type === 'text/html') {
                const reader = new FileReader();
                reader.onload = (e) => {
                    parseModList(e.target.result);
                };
                reader.readAsText(file);
            } else {
                alert("Please upload a valid HTML file.");
            }
        });
    </script>
</body>
</html>
